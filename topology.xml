<?xml version='1.0' encoding='UTF-8'?>
<scenario name="/vagrant/napt/topology.xml">
  <networks>
    <network id="4" name="n4" type="SWITCH">
      <position x="223" y="74" lat="47.57849406086843" lon="-122.12931713537462" alt="2.0"/>
    </network>
  </networks>
  <devices>
    <device id="1" name="n1" type="host" class="" image="">
      <position x="64" y="36" lat="47.578839471231596" lon="-122.13145961732725" alt="2.0"/>
      <services>
        <service name="DefaultRoute"/>
      </services>
    </device>
    <device id="2" name="n2" type="router" class="" image="">
      <position x="436" y="74" lat="47.57849406086843" lon="-122.12644701804187" alt="2.0"/>
      <services>
        <service name="UserDefined"/>
      </services>
    </device>
    <device id="3" name="n3" type="host" class="" image="">
      <position x="677" y="72" lat="47.57851224041804" lon="-122.12319960828978" alt="2.0"/>
      <services>
        <service name="DefaultRoute"/>
      </services>
    </device>
    <device id="5" name="n5" type="host" class="" image="">
      <position x="66" y="121" lat="47.57806683963548" lon="-122.13143266786872" alt="2.0"/>
      <services>
        <service name="DefaultRoute"/>
      </services>
    </device>
  </devices>
  <links>
    <link node_one="4" node_two="1">
      <interface_two id="0" name="eth0" mac="00:00:00:aa:00:00" ip4="10.0.0.10" ip4_mask="24"/>
      <options delay="0" bandwidth="0" per="0.0" dup="0" jitter="0" type="1" unidirectional="0"/>
    </link>
    <link node_one="4" node_two="2">
      <interface_two id="0" name="eth0" mac="00:00:00:aa:00:01" ip4="10.0.0.11" ip4_mask="24"/>
      <options delay="0" bandwidth="0" per="0.0" dup="0" jitter="0" type="1" unidirectional="0"/>
    </link>
    <link node_one="4" node_two="5">
      <interface_two id="0" name="eth0" mac="00:00:00:aa:00:04" ip4="10.0.0.12" ip4_mask="24"/>
      <options delay="0" bandwidth="0" per="0.0" dup="0" jitter="0" type="1" unidirectional="0"/>
    </link>
    <link node_one="2" node_two="3">
      <interface_one id="1" name="eth1" mac="00:00:00:aa:00:02" ip4="10.0.1.10" ip4_mask="24"/>
      <interface_two id="0" name="eth0" mac="00:00:00:aa:00:03" ip4="10.0.1.11" ip4_mask="24"/>
      <options delay="0" bandwidth="0" per="0.0" dup="0" jitter="0" type="1" unidirectional="0"/>
    </link>
  </links>
  <service_configurations>
    <service name="DefaultRoute" node="1">
      <startups>
        <startup>sh defaultroute.sh</startup>
      </startups>
      <files>
        <file name="defaultroute.sh">#!/bin/sh
# auto-generated by DefaultRoute service (utility.py)
ip route add default via 10.0.0.11
</file>
      </files>
    </service>
    <service name="NAT" node="2">
      <startups>
        <startup>sh nat.sh</startup>
      </startups>
      <files>
        <file name="nat.sh">#!/bin/sh
# generated by security.py
# NAT out the first interface by default
# NAT out the eth1 interface
iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE
iptables -A FORWARD -i eth1 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i eth1 -j DROP

# iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
# iptables -A FORWARD -i eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A FORWARD -i eth0 -j DROP
</file>
      </files>
    </service>
    <service name="DefaultRoute" node="3">
      <startups>
        <startup>sh defaultroute.sh</startup>
      </startups>
      <files>
        <file name="defaultroute.sh">#!/bin/sh
# auto-generated by DefaultRoute service (utility.py)
ip route add default via 10.0.1.10
</file>
      </files>
    </service>
    <service name="DefaultRoute" node="5">
      <startups>
        <startup>sh defaultroute.sh</startup>
      </startups>
      <files>
        <file name="defaultroute.sh">#!/bin/sh
# auto-generated by DefaultRoute service (utility.py)
ip route add default via 10.0.0.11
</file>
      </files>
    </service>
  </service_configurations>
  <session_origin lat="47.5791667" lon="-122.132322" alt="2.0" scale="150.0"/>
  <session_options>
    <configuration name="controlnet" value=""/>
    <configuration name="controlnet0" value=""/>
    <configuration name="controlnet1" value=""/>
    <configuration name="controlnet2" value=""/>
    <configuration name="controlnet3" value=""/>
    <configuration name="controlnet_updown_script" value=""/>
    <configuration name="enablerj45" value="1"/>
    <configuration name="preservedir" value="0"/>
    <configuration name="enablesdt" value="0"/>
    <configuration name="sdturl" value="tcp://127.0.0.1:50000/"/>
  </session_options>
  <session_metadata>
    <configuration name="canvas c1" value="{name {Canvas1}}"/>
    <configuration name="global_options" value="interface_names=yes ip_addresses=yes ipv6_addresses=no node_labels=yes link_labels=yes show_api=no background_images=no annotations=yes grid=yes traffic_start=0"/>
  </session_metadata>
  <default_services>
    <node type="mdr">
      <service name="zebra"/>
      <service name="OSPFv3MDR"/>
      <service name="IPForward"/>
    </node>
    <node type="PC">
      <service name="DefaultRoute"/>
    </node>
    <node type="prouter"/>
    <node type="router">
      <service name="zebra"/>
      <service name="OSPFv2"/>
      <service name="OSPFv3"/>
      <service name="IPForward"/>
    </node>
    <node type="host">
      <service name="DefaultRoute"/>
      <service name="SSH"/>
    </node>
  </default_services>
</scenario>
